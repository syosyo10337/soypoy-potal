# 管理者管理機能

## 概要

SOY-POYの管理画面では、管理者アカウントの管理機能を提供しています。
スーパー管理者は他の管理者の作成・編集・削除、およびパスワードリセットが可能です。

## ロール（権限）

| ロール | 説明 | 権限 |
|--------|------|------|
| `super_admin` | スーパー管理者 | 全ての操作が可能 |
| `admin` | 管理者 | 管理者一覧の閲覧、自分のパスワード変更のみ |

## 機能一覧

### 管理者一覧 (`/admin/admins`)

- 全ての管理者を一覧表示
- 名前、メールアドレス、ロール、作成日を表示
- スーパー管理者のみ「新規作成」ボタンが表示される

### 管理者詳細 (`/admin/admins/:id`)

- 管理者の詳細情報を表示
- スーパー管理者は以下の操作が可能：
  - パスワードリセット
  - 管理者の削除
- 自分自身のパスワードリセット・削除は不可

### 管理者作成 (`/admin/admins/create`)

- スーパー管理者のみアクセス可能
- 必要な情報：
  - 名前
  - メールアドレス
  - パスワード（12文字以上）
  - ロール（admin / super_admin）

### 管理者編集 (`/admin/admins/:id/edit`)

- スーパー管理者のみアクセス可能
- 編集可能な項目：
  - 名前
  - メールアドレス
  - ロール

### パスワード変更 (`/admin/settings/change-password`)

- 全ての管理者がアクセス可能
- 自分自身のパスワードを変更
- 現在のパスワードの入力が必要

## パスワードリセットフロー

### スーパー管理者によるリセット

1. スーパー管理者が管理者詳細画面で「パスワードをリセット」をクリック
2. 確認ダイアログが表示される
3. リセットを実行すると、一時パスワードが生成・表示される
4. 一時パスワードを対象の管理者に伝える（Slack、電話等）
5. 対象の管理者は一時パスワードでログイン
6. 「パスワード変更」画面で新しいパスワードを設定

### 注意事項

- 一時パスワードは一度しか表示されない
- パスワードリセット時、対象ユーザーの全セッションが無効化される
- 自分自身のパスワードはリセットできない（パスワード変更画面を使用）

## API エンドポイント

### 管理者関連 (`admins`)

| メソッド | エンドポイント | 権限 | 説明 |
|----------|---------------|------|------|
| `list` | `admins.list` | admin以上 | 管理者一覧取得 |
| `getById` | `admins.getById` | admin以上 | 管理者詳細取得 |
| `create` | `admins.create` | super_admin | 管理者作成 |
| `update` | `admins.update` | super_admin | 管理者更新 |
| `delete` | `admins.delete` | super_admin | 管理者削除 |
| `resetPassword` | `admins.resetPassword` | super_admin | パスワードリセット |

### 認証関連 (`auth`)

| メソッド | エンドポイント | 権限 | 説明 |
|----------|---------------|------|------|
| `changePassword` | `auth.changePassword` | admin以上 | 自分のパスワード変更 |

## セキュリティ

### パスワード要件

- 最小12文字
- ハッシュアルゴリズム: scrypt

### 権限チェック

- tRPCミドルウェアで実装
- `protectedProcedure`: 認証済みユーザー
- `adminProcedure`: admin または super_admin
- `superAdminProcedure`: super_admin のみ

## トラブルシューティング

### 管理者がログインできない

1. メールアドレスが正しいか確認
2. パスワードが正しいか確認
3. スーパー管理者にパスワードリセットを依頼

### スーパー管理者全員がロックアウトされた

`docs/create-super-admin.md` の緊急時対応手順を参照してください。

